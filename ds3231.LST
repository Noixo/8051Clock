C51 COMPILER V9.56.0.0   DS3231                                                            10/29/2017 01:41:25 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE DS3231
OBJECT MODULE PLACED IN .\Objects\ds3231.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ds3231.c OPTIMIZE(9,SIZE) BROWSE MODP2 DEBUG OBJECTEXTEND TABS(2) OBJECT
                    -(.\Objects\ds3231.obj)

line level    source

   1          #include "ds3231.h"
   2          #include "i2c.h"
   3          
   4          unsigned char decToBcd(unsigned char convert)
   5          {
   6   1        return ((convert / 10 * 16) + (convert % 10));
   7   1      }
   8          
   9          unsigned char bcdToDec(unsigned char convert)
  10          {
  11   1        return ((convert / 16 * 10) + (convert % 16));
  12   1      }
  13          /*
  14          unsigned char* rtc_get_temp()
  15          {
  16            unsigned char i;
  17            //static unsigned char temp[1];
  18            
  19            i2c_start();
  20            (void) i2c_device_id(0x68, 0);
  21            i2c_write(0x11);  //point 1st temp register
  22            i2c_stop();
  23            i2c_start();
  24            
  25            (void) i2c_device_id(0x68, 1);
  26            
  27            i = i2c_read(0) << 8;
  28            i |= i2c_read(1);
  29            //get data, convert to two's compliment and then store in array
  30            //temp[0] = i2c_read(0);//toTwosComplement(i2c_read(0));
  31            //temp[1] = i2c_read(1);//toTwosComplement(i2c_read(1));  //last piece of data to grab
  32            i2c_stop();
  33            
  34            return i;
  35          }
  36          */
  37          unsigned char* rtc_get_time()
  38          {
  39   1        static unsigned char time[6];
  40   1        char i;
  41   1        
  42   1        i2c_start();
  43   1        (void) i2c_device_id(0x68,0); //send address + write bit
  44   1        
  45   1        i2c_write(0); //point to location i of DS3231
  46   1        
  47   1        i2c_stop();
  48   1        i2c_start();
  49   1        
  50   1        (void) i2c_device_id(0x68, 1);  //send address + read bit
  51   1        
  52   1        for(i = 0; i < 7; i++)
  53   1        {
  54   2            time[i] = bcdToDec(i2c_read(0));
C51 COMPILER V9.56.0.0   DS3231                                                            10/29/2017 01:41:25 PAGE 2   

  55   2        }
  56   1        time[i] = bcdToDec(i2c_read(1));  //set to not ack when 6th loop
  57   1        
  58   1        i2c_stop();
  59   1        return time;
  60   1      }
  61          
  62          void rtc_set_time(unsigned char* setTime)
  63          {
  64   1        char i;
  65   1        //multi-byte set time
  66   1        
  67   1        i2c_start();
  68   1        (void) i2c_device_id(0x68, 1);
  69   1        i2c_write(0); //point to seconds
  70   1        
  71   1        for(i = 0; setTime != '\0'; i++)
  72   1        {
  73   2          i2c_write(setTime[i]);
  74   2        }
  75   1        i2c_stop();
  76   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    172    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      6       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
