C51 COMPILER V9.56.0.0   LCD                                                               08/14/2017 01:59:44 PAGE 1   


C51 COMPILER V9.56.0.0, COMPILATION OF MODULE LCD
OBJECT MODULE PLACED IN .\Objects\LCD.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE LCD.c ROM(SMALL) OPTIMIZE(9,SIZE) BROWSE DEBUG OBJECTEXTEND TABS(2) OBJE
                    -CT(.\Objects\LCD.obj)

line level    source

   1          //#include <stdio.h>
   2          #include "LCD.h"
   3          #include "timing.h"
   4          
   5          //current_line = 0;
   6          
   7          void init()
   8          {
   9   1        //RS = 0; //command
  10   1        ms_delay(15);
  11   1        
  12   1        cmd(0x38);  //Function set (8 bit, 2 line, 5x7)
  13   1        ms_delay(5);
  14   1      
  15   1        cmd(0x06);  //Entry mode (Left to right, inc)
  16   1      
  17   1        cmd(0x0F);  //display (Display on, cursor blinking)
  18   1      
  19   1        cmd(LCD_CLEAR); //CLEAR
  20   1      }
  21          
  22          void cmd(unsigned char cmd)
  23          {
  24   1        RS = 0;
  25   1        write_byte = cmd;
  26   1        E = 0;
  27   1        us_delay(150);
  28   1        E = 1;
  29   1      }
  30          
  31          void write_char(unsigned char letter)
  32          {
  33   1        /* if(letter > 0x7F)  //127
  34   1          cmd(0x39);  //8 bit, 2 line, 5x10
  35   1        else
  36   1          cmd(0x38);  */
  37   1        //letter += '0';  //Convert all chars to ASCII.
  38   1        
  39   1        RS = 1; //word;
  40   1        write_byte = letter;
  41   1        E = 0;
  42   1        us_delay(100);
  43   1        E = 1;
  44   1      }
  45          
  46          void backlight_toggle()
  47          {
  48   1        backlight = ~backlight;
  49   1      } 
  50          
  51          void write_string(unsigned char *string)//[])
  52          {
  53   1        //unsigned char string[8];
  54   1        unsigned char i = 0;
C51 COMPILER V9.56.0.0   LCD                                                               08/14/2017 01:59:44 PAGE 2   

  55   1        
  56   1        //if(array == (int) array)
  57   1        //iota(array, string, 10);
  58   1        //sprintf(string, "%u", array); //Convert everything to string
  59   1        
  60   1        //RS = 1; //ensure we are writing string
  61   1        for(i = 0; string[i] != '\0'; i++)
  62   1        {
  63   2          if(string[i] == '\n')//0x5C 0x6E) // 0x5c is '\', 0x6E is 'n'
  64   2          {
  65   3            new_line();
  66   3          }
  67   2          else
  68   2          {
  69   3            write_char(string[i]);
  70   3          }
  71   2        }
  72   1      }
  73          
  74          void write_int(unsigned char value)
  75          {
  76   1        char i, j;
  77   1        unsigned char temp = value;
  78   1        unsigned char array[3];
  79   1        
  80   1        /*
  81   1        for(i = 0; i < 3; i++)
  82   1        {
  83   1          if(temp / 10 == 0 && i > 0)
  84   1            array[i+1] = '\0';
  85   1          temp /= 10;
  86   1        } */
  87   1        
  88   1        for(i = 2; i >= 0; i--)
  89   1        {
  90   2          array[i] = value % 10 + '0';
  91   2          if(value / 10 == 0 && i > 0)
  92   2          {
  93   3            array[i-1] = '\0';
  94   3            break;
  95   3          }
  96   2          value /= 10;
  97   2        }
  98   1        
  99   1        //reverse_array(array);
 100   1        
 101   1        for(i = 0; i < 3; i++)
 102   1        {
 103   2          for(j = 0; j < 3-i; j++)
 104   2          {
 105   3            if(array[i] == '\0' && array[i+1] > 0)
 106   3            {
 107   4              temp = array[i];
 108   4              array[i] = array[i+1];
 109   4              array[i+1] = temp;
 110   4            }
 111   3          }
 112   2        }
 113   1        //push contents of array 
 114   1        
 115   1        write_string(array);
 116   1      }
C51 COMPILER V9.56.0.0   LCD                                                               08/14/2017 01:59:44 PAGE 3   

 117          
 118          void reverse_array(unsigned char *array)
 119          {
 120   1        unsigned char start = 0, end = 2, temp = 0;
 121   1        while(start < end)
 122   1        {
 123   2          temp = array[start];
 124   2          array[start] = array[end];
 125   2          array[end] = temp;
 126   2          start++;
 127   2          end--;
 128   2        }
 129   1      }
 130          
 131          void new_line()
 132          {
 133   1        if(!current_line)
 134   1        {
 135   2          cmd(LCD_LINE_2);//^ 0xC0);
 136   2        }
 137   1        else
 138   1        {
 139   2          cmd(LCD_LINE_1);
 140   2        }
 141   1        current_line = ~current_line;
 142   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    293    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      8      10
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
